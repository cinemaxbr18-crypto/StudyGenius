<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyGenius Pro - Sistema Otimizado</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel & Marked -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        /* Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans selection:bg-indigo-100">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- SISTEMA DE API ROBUSTO ---
        const API_KEY_KEY = 'studygenius_pro_key';

        // √çcones SVG Otimizados
        const Icon = ({ d, className }) => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={d} /></svg>;
        const Icons = {
            Brain: () => <Icon d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z" className="w-6 h-6"/>,
            Book: () => <Icon d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" className="w-6 h-6"/>,
            Check: () => <Icon d="M20 6L9 17l-5-5" className="w-5 h-5"/>,
            X: () => <Icon d="M18 6L6 18M6 6l12 12" className="w-5 h-5"/>,
            ArrowLeft: () => <Icon d="M19 12H5M12 19l-7-7 7-7" className="w-5 h-5"/>,
            ArrowRight: () => <Icon d="M5 12h14M12 5l7 7-7 7" className="w-5 h-5"/>,
            Settings: () => <Icon d="M12.22 2h-.44a2 2 0 0 1-2 2 2 2 0 0 0-2 2 2 2 0 0 1-2 2 2 2 0 0 0-2 2 2 2 0 0 1-2 2v.44a2 2 0 0 1 2 2 2 2 0 0 0 2 2 2 2 0 0 1 2 2 2 2 0 0 0 2 2 2 2 0 0 1 2 2h.44a2 2 0 0 1 2-2 2 2 0 0 0 2-2 2 2 0 0 1 2-2 2 2 0 0 0 2-2 2 2 0 0 1 2-2v-.44a2 2 0 0 1-2-2 2 2 0 0 0-2-2 2 2 0 0 1-2-2 2 2 0 0 0-2-2 2 2 0 0 1-2-2z" className="w-5 h-5"/>,
            Chat: () => <Icon d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" className="w-6 h-6"/>,
            Send: () => <Icon d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" className="w-5 h-5"/>,
            Lightbulb: () => <Icon d="M9 18h6M10 22h4M15 14a3 3 0 0 0-3-3 3 3 0 0 0-3 3 6 6 0 0 0 6 0z" className="w-5 h-5"/>,
            Download: () => <Icon d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" className="w-5 h-5"/>,
            Maximize: () => <Icon d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7" className="w-5 h-5"/>,
            Minimize: () => <Icon d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3" className="w-5 h-5"/>
        };

        // --- MOTOR DE API COM RETRY (SOLU√á√ÉO PARA O ERRO 429) ---
        const callGemini = async (prompt) => {
            const apiKey = localStorage.getItem(API_KEY_KEY);
            if (!apiKey) throw new Error("NO_KEY");

            // Usa o modelo 'flash' que √© mais r√°pido e econ√¥mico
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
            
            let attempts = 0;
            const maxAttempts = 3;

            while (attempts < maxAttempts) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });

                    if (response.status === 429) {
                        attempts++;
                        // Espera exponencial (1s, 2s, 4s) antes de tentar de novo
                        await new Promise(r => setTimeout(r, 1000 * Math.pow(2, attempts)));
                        continue;
                    }

                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.error?.message || "Erro desconhecido na API");
                    }

                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "";
                } catch (error) {
                    if (attempts === maxAttempts - 1) throw error;
                    attempts++;
                }
            }
        };

        const extractJSON = (text) => {
            try {
                const match = text.match(/```json\n([\s\S]*?)\n```/) || text.match(/```([\s\S]*?)```/);
                return JSON.parse(match ? match[1] : text);
            } catch (e) { return null; }
        };

        // --- COMPONENTES AUXILIARES ---

        const ModalKey = ({ onClose }) => {
            const [key, setKey] = useState('');
            return (
                <div className="fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in">
                    <div className="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md">
                        <h2 className="text-xl font-bold text-slate-800 mb-2">Configurar Chave API</h2>
                        <p className="text-slate-500 text-sm mb-4">Para usar a IA, voc√™ precisa de uma chave do Google Gemini.</p>
                        <input 
                            type="password" 
                            value={key}
                            onChange={e => setKey(e.target.value)}
                            placeholder="Cole sua chave AIza..."
                            className="w-full p-3 border border-slate-300 rounded-xl mb-4 focus:ring-2 focus:ring-indigo-500 outline-none"
                        />
                        <div className="flex gap-2">
                            <button onClick={onClose} className="flex-1 py-3 text-slate-600 font-bold hover:bg-slate-100 rounded-xl">Cancelar</button>
                            <button 
                                onClick={() => {
                                    if(key.trim().length > 10) {
                                        localStorage.setItem(API_KEY_KEY, key.trim());
                                        window.location.reload();
                                    }
                                }} 
                                className="flex-1 py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700"
                            >
                                Salvar
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const ChatTutor = ({ currentTopic }) => {
            const [mode, setMode] = useState('closed'); // closed, popup, full
            const [messages, setMessages] = useState([{ role: 'ai', text: 'Ol√°! Sou seu tutor. D√∫vidas?' }]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const scrollRef = useRef();

            useEffect(() => scrollRef.current?.scrollIntoView({ behavior: 'smooth' }), [messages, mode]);

            const send = async () => {
                if(!input.trim() || loading) return;
                const text = input;
                setInput('');
                setMessages(p => [...p, { role: 'user', text }]);
                setLoading(true);

                try {
                    const prompt = `Atue como tutor de "${currentTopic || 'Geral'}". Pergunta: "${text}". Responda de forma did√°tica e curta. Use Markdown.`;
                    const res = await callGemini(prompt);
                    setMessages(p => [...p, { role: 'ai', text: res }]);
                } catch (e) {
                    setMessages(p => [...p, { role: 'ai', text: "Erro de conex√£o. Verifique sua chave." }]);
                } finally { setLoading(false); }
            };

            if(mode === 'closed') return (
                <button onClick={() => setMode('popup')} className="fixed bottom-6 right-6 bg-indigo-600 text-white p-4 rounded-full shadow-xl hover:scale-110 transition-all z-50">
                    <Icons.Chat />
                </button>
            );

            const isFull = mode === 'full';
            const containerClass = isFull 
                ? "fixed inset-0 z-[60] bg-white flex flex-col animate-fade-in"
                : "fixed bottom-6 right-6 z-[60] w-96 h-[500px] bg-white rounded-2xl shadow-2xl border flex flex-col animate-fade-in overflow-hidden";

            return (
                <div className={containerClass}>
                    <div className="bg-indigo-600 p-4 text-white flex justify-between items-center shrink-0">
                        <div className="flex items-center gap-2 font-bold"><Icons.Brain /> Tutor IA</div>
                        <div className="flex gap-2">
                            <button onClick={() => setMode(isFull ? 'popup' : 'full')} className="p-1 hover:bg-white/20 rounded">
                                {isFull ? <Icons.Minimize /> : <Icons.Maximize />}
                            </button>
                            <button onClick={() => setMode('closed')} className="p-1 hover:bg-white/20 rounded"><Icons.X /></button>
                        </div>
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 custom-scroll">
                        {messages.map((m, i) => (
                            <div key={i} className={`p-3 rounded-2xl text-sm max-w-[85%] ${m.role === 'user' ? 'bg-indigo-600 text-white self-end ml-auto rounded-br-none' : 'bg-white border text-slate-800 rounded-bl-none'}`}>
                                <div dangerouslySetInnerHTML={{ __html: marked.parse(m.text) }} />
                            </div>
                        ))}
                        {loading && <div className="text-xs text-slate-400 italic">Digitando...</div>}
                        <div ref={scrollRef} />
                    </div>
                    <div className="p-3 border-t bg-white flex gap-2 shrink-0">
                        <input value={input} onChange={e => setInput(e.target.value)} onKeyDown={e => e.key === 'Enter' && send()} placeholder="Digite sua d√∫vida..." className="flex-1 bg-slate-100 rounded-xl px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500"/>
                        <button onClick={send} className="bg-indigo-600 text-white p-2 rounded-xl"><Icons.Send /></button>
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        function App() {
            const [view, setView] = useState('home');
            const [showKeyModal, setShowKeyModal] = useState(false);
            const [loading, setLoading] = useState(false);
            const [topics, setTopics] = useState('');
            const [errorMsg, setErrorMsg] = useState('');
            
            // Estados de Dados
            const [quizConfig, setQuizConfig] = useState({ count: 5, difficulty: 'Intermedi√°rio' });
            const [flashcards, setFlashcards] = useState([]);
            const [quizData, setQuizData] = useState([]);
            const [quizAnswers, setQuizAnswers] = useState({});
            const [quizResult, setQuizResult] = useState(null);
            const [analysis, setAnalysis] = useState(null);
            
            // Controle UI
            const [cardIdx, setCardIdx] = useState(0);
            const [flipped, setFlipped] = useState(false);
            const [hints, setHints] = useState({});

            // Checar chave ao iniciar
            useEffect(() => {
                if (!localStorage.getItem(API_KEY_KEY)) setShowKeyModal(true);
            }, []);

            const handleError = (e) => {
                setLoading(false);
                if (e.message === "NO_KEY") setShowKeyModal(true);
                else setErrorMsg(`Erro: ${e.message}. Verifique sua chave ou conex√£o.`);
            };

            const generateFlashcards = async (customTopic) => {
                const target = customTopic || topics;
                if(!target.trim()) return setErrorMsg("Digite um t√≥pico.");
                setLoading(true); setErrorMsg('');

                const prompt = `Gere 8 flashcards sobre "${target}". Verifique fatos 3x. Retorne JSON Array: [{"front": "pergunta", "back": "resposta"}]`;
                try {
                    const text = await callGemini(prompt);
                    const json = extractJSON(text);
                    if(json) { setFlashcards(json); setCardIdx(0); setFlipped(false); setView('flashcards'); }
                    else throw new Error("Falha ao ler resposta da IA");
                } catch(e) { handleError(e); } 
                finally { setLoading(false); }
            };

            const generateQuiz = async () => {
                if(!topics.trim()) return setErrorMsg("Digite um t√≥pico.");
                setLoading(true); setErrorMsg('');

                const prompt = `Gere um quiz de ${quizConfig.count} perguntas n√≠vel ${quizConfig.difficulty} sobre "${topics}". Verifique se h√° apenas uma resposta correta. Retorne JSON Array: [{"question": "...", "options": ["A","B","C","D"], "correctIndex": 0, "hint": "...", "explanation": "..."}]`;
                try {
                    const text = await callGemini(prompt);
                    const json = extractJSON(text);
                    if(json) { setQuizData(json); setQuizAnswers({}); setHints({}); setView('quiz'); }
                    else throw new Error("Falha ao gerar quiz");
                } catch(e) { handleError(e); }
                finally { setLoading(false); }
            };

            const finishQuiz = async () => {
                let score = 0;
                const report = quizData.map((q, i) => {
                    const correct = quizAnswers[i] === q.correctIndex;
                    if(correct) score++;
                    return { q: q.question, correct, user: q.options[quizAnswers[i]], correctAns: q.options[q.correctIndex], explanation: q.explanation };
                });
                setQuizResult({ score, total: quizData.length, report });
                setLoading(true);

                const prompt = `Analise: T√≥pico "${topics}", Nota ${score}/${quizData.length}. JSON: {"feedback": "...", "weakPoints": ["..."], "studyPlan": "..."}`;
                try {
                    const text = await callGemini(prompt);
                    setAnalysis(extractJSON(text));
                    setView('analysis');
                } catch(e) { handleError(e); }
                finally { setLoading(false); }
            };

            const downloadReport = () => {
                if(!analysis) return;
                const text = `STUDYGENIUS REPORT\nT√≥pico: ${topics}\nNota: ${quizResult.score}/${quizResult.total}\n\nFEEDBACK:\n${analysis.feedback}\n\nPLANO:\n${analysis.studyPlan}`;
                const blob = new Blob([text], {type: 'text/plain'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Report-${topics}.txt`;
                a.click();
            };

            return (
                <div className="min-h-screen bg-slate-50 text-slate-900 pb-20">
                    {showKeyModal && <ModalKey onClose={() => setShowKeyModal(false)} />}
                    
                    {loading && (
                        <div className="fixed inset-0 bg-white/80 z-[80] flex flex-col items-center justify-center backdrop-blur-sm">
                            <div className="w-12 h-12 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin mb-4"></div>
                            <p className="font-bold text-indigo-900 animate-pulse">IA trabalhando (Verificando Fatos)...</p>
                        </div>
                    )}

                    <header className="h-16 bg-white border-b flex items-center px-6 justify-between sticky top-0 z-40 shadow-sm">
                        <div className="flex items-center gap-2 cursor-pointer text-indigo-700" onClick={() => setView('home')}>
                            <Icons.Brain /> <span className="font-black text-xl">StudyGenius</span>
                        </div>
                        <button onClick={() => setShowKeyModal(true)} className="p-2 hover:bg-slate-100 rounded-full text-slate-400" title="Configurar API">
                            <Icons.Settings />
                        </button>
                    </header>

                    <main className="max-w-5xl mx-auto p-6">
                        {errorMsg && (
                            <div className="bg-red-50 text-red-600 p-4 rounded-xl mb-6 flex justify-between items-center border border-red-100">
                                <span>{errorMsg}</span>
                                <button onClick={() => setErrorMsg('')}><Icons.X /></button>
                            </div>
                        )}

                        {view === 'home' && (
                            <div className="py-10 animate-fade-in space-y-8">
                                <div className="text-center space-y-4">
                                    <h1 className="text-5xl font-black text-slate-800">Domine qualquer assunto.</h1>
                                    <p className="text-slate-500 text-lg">Insira o tema e a IA cria seu plano de estudo perfeito.</p>
                                </div>

                                <div className="bg-white p-8 rounded-3xl shadow-xl border border-indigo-50">
                                    <textarea 
                                        value={topics} 
                                        onChange={e => setTopics(e.target.value)} 
                                        placeholder="Ex: Revolu√ß√£o Industrial, F√≠sica Qu√¢ntica, Verbos em Ingl√™s..." 
                                        className="w-full h-32 text-lg p-4 border rounded-xl focus:ring-4 focus:ring-indigo-50 outline-none resize-none mb-6 transition-all"
                                    />
                                    
                                    <div className="grid grid-cols-2 gap-4 pb-6 border-b border-slate-100">
                                        <div>
                                            <label className="text-xs font-bold text-slate-400 uppercase">Perguntas</label>
                                            <select value={quizConfig.count} onChange={e => setQuizConfig({...quizConfig, count: e.target.value})} className="w-full mt-1 p-2 bg-slate-50 rounded-lg border font-bold">
                                                <option value="5">5</option><option value="10">10</option><option value="15">15</option><option value="20">20</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="text-xs font-bold text-slate-400 uppercase">N√≠vel</label>
                                            <select value={quizConfig.difficulty} onChange={e => setQuizConfig({...quizConfig, difficulty: e.target.value})} className="w-full mt-1 p-2 bg-slate-50 rounded-lg border font-bold">
                                                <option value="Iniciante">Iniciante</option><option value="Intermedi√°rio">Intermedi√°rio</option><option value="Avan√ßado">Avan√ßado</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                                        <button onClick={() => generateFlashcards()} className="p-4 bg-indigo-50 text-indigo-700 font-bold rounded-xl hover:bg-indigo-100 transition-colors flex items-center justify-center gap-2">
                                            <Icons.Book /> Flashcards
                                        </button>
                                        <button onClick={generateQuiz} className="p-4 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-colors flex items-center justify-center gap-2 shadow-lg shadow-indigo-200">
                                            <Icons.Brain /> Gerar Quiz
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'flashcards' && (
                            <div className="py-10 flex flex-col items-center animate-fade-in gap-8">
                                <div className="w-full flex justify-between items-center text-slate-400 font-bold">
                                    <button onClick={() => setView('home')} className="flex items-center gap-2 hover:text-indigo-600"><Icons.ArrowLeft /> Voltar</button>
                                    <span>{cardIdx + 1} / {flashcards.length}</span>
                                </div>
                                <div className="w-full max-w-lg aspect-[3/2] perspective-1000 cursor-pointer group" onClick={() => setFlipped(!flipped)}>
                                    <div className={`relative w-full h-full transform-style-3d transition-all duration-500 shadow-2xl rounded-3xl ${flipped ? 'rotate-y-180' : ''}`}>
                                        <div className="absolute inset-0 bg-white backface-hidden rounded-3xl p-8 flex items-center justify-center text-center border-2 border-slate-100">
                                            <p className="text-2xl font-bold text-slate-800">{flashcards[cardIdx].front}</p>
                                        </div>
                                        <div className="absolute inset-0 bg-indigo-600 backface-hidden rotate-y-180 rounded-3xl p-8 flex items-center justify-center text-center text-white">
                                            <p className="text-xl font-medium leading-relaxed">{flashcards[cardIdx].back}</p>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex gap-4">
                                    <button disabled={cardIdx===0} onClick={() => {setCardIdx(c=>c-1); setFlipped(false)}} className="p-4 bg-white shadow rounded-full disabled:opacity-50"><Icons.ArrowLeft /></button>
                                    <button onClick={() => setFlipped(!flipped)} className="px-8 bg-slate-800 text-white rounded-full font-bold">Virar</button>
                                    <button disabled={cardIdx===flashcards.length-1} onClick={() => {setCardIdx(c=>c+1); setFlipped(false)}} className="p-4 bg-white shadow rounded-full disabled:opacity-50"><Icons.ArrowRight /></button>
                                </div>
                            </div>
                        )}

                        {view === 'quiz' && (
                            <div className="py-10 animate-fade-in space-y-6 pb-24">
                                <button onClick={() => setView('home')} className="text-slate-400 font-bold flex items-center gap-2 hover:text-red-500"><Icons.ArrowLeft /> Cancelar Quiz</button>
                                {quizData.map((q, i) => (
                                    <div key={i} className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                                        <h3 className="font-bold text-lg mb-4 flex gap-3"><span className="bg-slate-100 w-8 h-8 rounded flex items-center justify-center text-sm">{i+1}</span> {q.question}</h3>
                                        <div className="grid gap-2 pl-11">
                                            {q.options.map((opt, idx) => (
                                                <button 
                                                    key={idx} 
                                                    onClick={() => setQuizAnswers(prev => ({...prev, [i]: idx}))}
                                                    className={`p-3 text-left rounded-xl border transition-all ${quizAnswers[i] === idx ? 'bg-indigo-50 border-indigo-500 text-indigo-700 font-bold' : 'hover:bg-slate-50'}`}
                                                >
                                                    {opt}
                                                </button>
                                            ))}
                                        </div>
                                        <div className="ml-11 mt-3">
                                            {!hints[i] ? (
                                                <button onClick={() => setHints(p => ({...p, [i]: true}))} className="text-xs font-bold text-amber-500 flex items-center gap-1 hover:text-amber-600"><Icons.Lightbulb /> Ver Dica</button>
                                            ) : (
                                                <p className="text-sm bg-amber-50 text-amber-800 p-3 rounded-lg border border-amber-100">üí° {q.hint}</p>
                                            )}
                                        </div>
                                    </div>
                                ))}
                                <div className="fixed bottom-0 left-0 w-full p-4 bg-white/80 backdrop-blur border-t z-30 flex justify-center">
                                    <button 
                                        onClick={finishQuiz} 
                                        disabled={Object.keys(quizAnswers).length !== quizData.length}
                                        className="bg-green-600 hover:bg-green-700 text-white px-12 py-3 rounded-xl font-bold shadow-xl disabled:opacity-50 flex items-center gap-2 transition-all"
                                    >
                                        <Icons.Check /> Finalizar
                                    </button>
                                </div>
                            </div>
                        )}

                        {view === 'analysis' && (
                            <div className="py-10 animate-fade-in space-y-8 pb-20">
                                <div className="text-center">
                                    <h2 className="text-4xl font-black text-slate-800">Resultado</h2>
                                    <p className="text-6xl font-black text-indigo-600 my-4">{quizResult.score} <span className="text-2xl text-slate-300">/ {quizResult.total}</span></p>
                                </div>

                                <div className="bg-white p-8 rounded-3xl shadow-xl border border-indigo-50">
                                    <h3 className="font-bold text-indigo-800 mb-2 flex items-center gap-2"><Icons.Brain /> An√°lise do Tutor</h3>
                                    <p className="text-slate-600 leading-relaxed">{analysis.feedback}</p>
                                </div>

                                <div className="grid md:grid-cols-2 gap-6">
                                    <div className="bg-red-50 p-6 rounded-2xl border border-red-100">
                                        <h4 className="font-bold text-red-700 mb-4 flex items-center gap-2"><Icons.X /> Pontos Fracos</h4>
                                        <ul className="space-y-2">{analysis.weakPoints.map((p, i) => <li key={i} className="text-sm text-red-900 flex gap-2"><span className="w-1.5 h-1.5 bg-red-400 rounded-full mt-2 shrink-0"></span>{p}</li>)}</ul>
                                    </div>
                                    <div className="bg-green-50 p-6 rounded-2xl border border-green-100">
                                        <h4 className="font-bold text-green-700 mb-4 flex items-center gap-2"><Icons.Book /> Plano de Estudo</h4>
                                        <p className="text-sm text-green-900 leading-relaxed">{analysis.studyPlan}</p>
                                    </div>
                                </div>

                                <div className="flex justify-center gap-4">
                                    <button onClick={downloadReport} className="flex items-center gap-2 text-indigo-600 font-bold px-6 py-3 border rounded-xl hover:bg-slate-50"><Icons.Download /> Baixar Relat√≥rio</button>
                                    <button onClick={() => { setView('home'); setTopics(''); }} className="bg-slate-900 text-white font-bold px-8 py-3 rounded-xl hover:bg-black shadow-lg">Novo Assunto</button>
                                </div>

                                <div className="space-y-4 pt-8">
                                    <h3 className="font-bold text-xl border-b pb-4">Corre√ß√£o Detalhada</h3>
                                    {quizResult.report.map((r, i) => (
                                        <div key={i} className={`p-5 rounded-2xl bg-white shadow-sm border-l-4 ${r.correct ? 'border-green-500' : 'border-red-500'}`}>
                                            <div className="flex justify-between font-bold text-slate-800 mb-2">
                                                <span>{i+1}. {r.q}</span>
                                                <span className={r.correct ? 'text-green-600' : 'text-red-600'}>{r.correct ? 'CORRETO' : 'ERRADO'}</span>
                                            </div>
                                            <div className="text-sm bg-slate-50 p-3 rounded-lg space-y-1">
                                                <p>Sua resposta: <span className="font-bold">{r.user}</span></p>
                                                {!r.correct && <p>Correta: <span className="font-bold text-green-600">{r.correctAns}</span></p>}
                                                <p className="text-slate-500 italic mt-2 border-t pt-2">{r.explanation}</p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>

                    <ChatTutor currentTopic={topics} />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
